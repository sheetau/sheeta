<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="CbYcYiYRBtqbBzRcFrgow4wD0aZR5AceysXb3puyV5M" />
    <link rel="icon" href="icon.png" type="image/x-icon" />
    <link
      href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&display=swap"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&display=swap" rel="stylesheet" />
    <title>Sheeta's Portfolio</title>
    <style>
      :root {
        --page-max-width: 500px;

        --font-size-primary: 1.5rem;
        --font-size-secondary: 0.9rem;
        --font-size-tertiary: 0.8rem;
        --font-size-quaternary: 0.7rem;

        --color-text-primary: #fafafa;
        --color-text-secondary: #8a8a8a;
        --color-text-tertiary: #525252;

        --color-bg-primary: #050505;

        --color-border-primary: #313131;
        --color-border-translucent: #31313180;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      *::selection {
        background-color: var(--color-text-tertiary);
      }
      html {
        overflow: hidden;
      }
      body {
        font-family: "Figtree", "M PLUS 1p", sans-serif;
        background: var(--color-bg-primary);
        color: var(--color-text-primary);
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        font-size: var(--font-size-quaternary);
      }
      a {
        text-decoration: none;
        color: inherit;
      }

      #container {
        display: flex;
        flex-direction: row;
        max-width: var(--page-max-width);
        width: calc(100% - 10vw);
        height: 100%;
        margin: 0 auto;
      }

      /* side bar */
      #side-bar {
        display: flex;
        justify-content: flex-end;
        padding-right: min(5vw, 2rem);
        align-items: center;
        font-size: var(--font-size-secondary);
      }
      #label-wrapper {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }
      .side-bar-label {
        writing-mode: tb-rl;
        transform: rotate(-180deg);
        font-weight: 400;
        color: var(--color-text-tertiary);
        cursor: pointer;
        transition: color 0.3s ease;
        user-select: none;
      }
      .side-bar-label.active {
        color: var(--color-text-primary);
      }
      .side-bar-label:not(.active):hover {
        color: var(--color-text-secondary);
      }

      /* main */
      main {
        height: 100%;
        min-width: 0;
        display: flex;
        flex: 1;
        flex-direction: column;
        border-left: 1px solid var(--color-border-translucent);
      }
      .main-top,
      .main-bottom {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .main-top {
        justify-content: flex-end;
      }
      .main-middle {
        aspect-ratio: 5/3;
        display: flex;
        justify-content: center;
        position: relative;
        overflow: visible;
        clip-path: inset(0 -100vw 0 0);
      }
      .main-bottom {
        justify-content: flex-start;
        overflow: visible;
        clip-path: inset(0 -100vw 0 0);
      }
      #about,
      #works,
      #works-description,
      #works-options,
      #about-options {
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }
      #about.show,
      #works.show,
      #works-description.show,
      #works-options.show,
      #about-options.show {
        opacity: 1;
        pointer-events: auto;
      }

      /* main top */
      .main-top h1 {
        font-size: var(--font-size-primary);
        font-weight: 500;
        margin-bottom: 4rem;
        cursor: pointer;
      }
      #options {
        margin-bottom: 3rem;
        position: relative;
        cursor: default;
        height: fit-content;
      }
      #works-options {
        display: flex;
        position: absolute;
      }
      #about-options {
        position: absolute;
        display: none;
      }
      .option-left,
      .option-right {
        display: inline-block;
        width: 1.3rem;
        color: var(--color-text-primary);
        transition: color 0.3s ease;
      }
      #about-options .option-left:not(.active):hover,
      #about-options .option-right:not(.active):hover {
        color: var(--color-text-secondary);
        cursor: pointer;
      }
      #about-options .option-left:not(.active),
      #about-options .option-right:not(.active) {
        color: var(--color-text-tertiary);
      }
      #about-options .option-middle {
        color: var(--color-text-tertiary);
      }
      .option-right {
        text-align: right;
      }

      /* main middle */
      #about {
        display: none;
        line-height: 1.5;
        font-size: var(--font-size-tertiary);
        height: 100%;
        position: absolute;
        overflow: hidden;
      }
      #about a {
        text-decoration: underline;
        transition: color 0.3s ease;
      }
      #about a:hover {
        color: var(--color-text-secondary);
      }
      #works {
        height: 100%;
        min-width: 100%;
        display: flex;
        position: absolute;
        left: 0;
      }
      .block {
        flex-shrink: 0;
        height: 100%;
        width: 100%;
        margin-right: 1rem;
        transition: margin 0.3s ease, outline 0.3s ease;
        will-change: opacity outline;
        outline: 0 solid color-mix(in srgb, var(--color-text-primary), transparent 100%);
        outline-offset: -1px;
      }
      .block img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border: none;
      }
      #works .block.active {
        cursor: default;
      }
      #works .block:not(.active) {
        cursor: pointer;
      }
      #works .block:not(.active):hover {
        outline: 1px solid color-mix(in srgb, var(--color-text-primary), transparent 0%);
      }

      /* main bottom */
      #works-description {
        height: 8rem;
        min-width: 100%;
        display: flex;
        left: 0;
        position: relative;
        color: var(--color-text-secondary);
        line-height: 1.5;
      }
      #works-description .title {
        display: inline-block;
        position: relative;
        margin: 1.2rem 0 0.8rem;
        font-size: var(--font-size-secondary);
        color: var(--color-text-primary);
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: fit-content;
      }
      #works-description .title a {
        overflow: hidden;
      }

      #works-description .title a::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background-color: var(--color-text-primary);
        opacity: 0;
        transition: opacity 0.3s, transform 0.3s;
        transform: translate3d(-100%, 0, 0);
      }

      #works-description .title a:hover::after,
      #works-description .title a:focus::after {
        opacity: 1;
        transform: translate3d(0, 0, 0);
      }
      #works-description div:not(.title) {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 4;
        text-overflow: ellipsis;
      }

      .main-bottom {
        position: relative;
      }
      #socials {
        position: absolute;
        top: 0;
        width: fit-content;
        transition: top 0.3s ease;
        font-size: var(--font-size-tertiary);
      }
      #socials.active {
        top: 10rem;
      }
      .social-link {
        display: flex;
        flex-direction: row;
        align-items: center;
        margin-bottom: 1rem;
      }
      .left-bar {
        width: 2.5rem;
        padding-right: 2rem;
        height: 1px;
        background: var(--color-text-primary);
        background-clip: content-box;
        transition: padding 0.3s ease;
        order: 1;
      }
      .social-link a {
        order: 2;
      }
      .social-link a:hover ~ .left-bar {
        padding-right: 1.5rem;
      }

      @media (max-width: 480px) {
        #about {
          font-size: var(--font-size-quaternary);
          line-height: 1.3;
        }
        #socials:not(.active) {
          top: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="side-bar">
        <div id="label-wrapper">
          <span id="aboutLabel" class="side-bar-label">About</span>
          <span id="worksLabel" class="side-bar-label active">Works</span>
        </div>
      </div>

      <main>
        <div class="main-top">
          <h1 onclick="location.reload()">Sheeta</h1>
          <div id="options">
            <div id="about-options">
              <span class="option-left">EN</span>
              <span class="option-middle">—</span>
              <span class="option-right">JP</span>
            </div>
            <div id="works-options" class="show">
              <span class="option-left"></span>
              <span class="option-middle">—</span>
              <span class="option-right"></span>
            </div>
          </div>
        </div>

        <div class="main-middle">
          <div id="about">
            <p class="lang en">
              Thank you for visiting my portfolio. My name is Sheeta, and I was born in Tokyo, Japan, in 2001.<br />
              I mainly work on UI design for websites and develop using HTML, CSS, and JavaScript.<br />
              This website was also designed and coded by me.<br />
              In my free time, I enjoy drawing and video editing as hobbies.<br /><br />
              For work inquiries, please contact me at
              <a href="mailto:sheeta.contact@gmail.com">sheeta.contact@gmail.com</a>.
            </p>

            <p class="lang jp">
              ポートフォリオをご覧いただきありがとうございます。しいたです。2001年東京生まれです。<br />
              主にWebサイトのUIデザインや、HTML、CSS、JavaScriptを用いた開発を行っています。<br />
              このウェブサイトも私がデザイン・コーディングをしました。<br />
              趣味ではイラストを描いたり、動画編集をしたりしています。<br /><br />
              お仕事のご依頼は、<a href="mailto:sheeta.contact@gmail.com">sheeta.contact@gmail.com</a>
              までご連絡ください。
            </p>
          </div>
          <div id="works" class="show"></div>
        </div>

        <div class="main-bottom">
          <div id="works-description" class="show"></div>
          <div id="socials" class="active">
            <div class="social-link">
              <a href="https://github.com/sheetau" target="_blank">GitHub</a>
              <div class="left-bar"></div>
            </div>
            <div class="social-link">
              <a href="https://linktr.ee/sheetau" target="_blank">Linktree</a>
              <div class="left-bar"></div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script>
      const items = [
        {
          image: "https://raw.githubusercontent.com/sheetau/pfpcropper/refs/heads/main/preview.png",
          link: "https://sheetau.github.io/pfpcropper/",
        },
        {
          image: "https://raw.githubusercontent.com/sheetau/monapad/refs/heads/main/screenshots/monapad_ss_onyx.png",
          link: "https://github.com/sheetau/monapad",
        },
        { image: "", link: "https://sheetau.github.io/monapad/" },
      ];

      const works = document.querySelector("#works");
      const about = document.querySelector("#about");
      const socials = document.querySelector("#socials");
      const worksLabel = document.getElementById("worksLabel");
      const aboutLabel = document.getElementById("aboutLabel");
      const descriptions = document.querySelector("#works-description");
      const worksOptions = document.getElementById("works-options");
      const worksOptionLeft = document.querySelector("#works-options .option-left");
      const worksOptionRight = document.querySelector("#works-options .option-right");
      const aboutOptions = document.getElementById("about-options");
      const aboutOptionLeft = document.querySelector("#about-options .option-left");
      const aboutOptionRight = document.querySelector("#about-options .option-right");
      const mainMiddle = document.querySelector(".main-middle");
      const labelWrapper = document.getElementById("label-wrapper");

      let index = 0;
      let isAboutShown = false;
      let isTransitioning = false;
      const total = items.length;
      const blockWidth = works.clientWidth;
      let lastUpScrollTime = 0;

      // mobile swipe
      let touchStartX = 0;
      let touchEndX = 0;
      const swipeTargets = [mainMiddle, descriptions];

      // language
      let currentLang = navigator.language.startsWith("ja") ? "jp" : "en";
      const langElements = document.querySelectorAll(".lang");
      langElements.forEach((el) => {
        el.style.display = el.classList.contains(currentLang) ? "block" : "none";
      });

      function switchLanguage(lang) {
        if (currentLang === lang && aboutOptions.classList.contains("active")) return;

        currentLang = lang;
        const langElements = document.querySelectorAll(".lang");

        langElements.forEach((el) => {
          if (el.classList.contains(lang)) {
            el.style.display = "block";
          } else {
            el.style.display = "none";
          }
        });

        aboutOptionLeft.classList.toggle("active", lang === "en");
        aboutOptionRight.classList.toggle("active", lang === "jp");
      }
      switchLanguage(currentLang);
      aboutOptionLeft.onclick = () => switchLanguage("en");
      aboutOptionRight.onclick = () => switchLanguage("jp");

      // works/about display toggle
      // ---- fade effect ----
      function fadeSwitch(showElms = [], hideElms = [], afterCallback = () => {}) {
        if (isTransitioning) return;
        isTransitioning = true;

        hideElms.forEach((el) => {
          el.classList.remove("show");
          setTimeout(() => {
            el.style.display = "none";
          }, 300);
        });

        showElms.forEach((el) => {
          el.style.display = "flex";
          void el.offsetWidth;
          el.classList.add("show");
        });

        setTimeout(() => {
          afterCallback();
          isTransitioning = false;
        }, 300);
      }

      // ---- display toggle ----
      function switchToView(view, trigger = "direct") {
        if (isTransitioning) return;

        const isAlreadyActive =
          view === "works" ? worksLabel.classList.contains("active") : aboutLabel.classList.contains("active");

        if (view === "works") {
          if (isAlreadyActive && index === 0 && trigger !== "scroll") return;

          worksLabel.classList.add("active");
          aboutLabel.classList.remove("active");
          socials.classList.add("active");
          isAboutShown = false;

          if (isAlreadyActive && trigger !== "scroll") {
            index = 0;
            updateMargin();
          }

          fadeSwitch([works, descriptions, worksOptions], [about, aboutOptions]);
        } else if (view === "about") {
          if (isAlreadyActive) return;

          aboutLabel.classList.add("active");
          worksLabel.classList.remove("active");
          socials.classList.remove("active");
          isAboutShown = true;

          fadeSwitch([about, aboutOptions], [works, descriptions, worksOptions]);
          setTimeout(() => {
            index = 0;
            updateMargin();
          }, 300);
        }
      }

      // ---- Click Handlers ----
      aboutLabel.addEventListener("click", () => switchToView("about"));
      worksLabel.addEventListener("click", () => switchToView("works"));

      // ---- Scroll Handler ----
      window.addEventListener(
        "wheel",
        (e) => {
          if (e.ctrlKey || e.deltaY === 0) return;

          if (isAboutShown && e.deltaY > 0) {
            switchToView("works", "scroll");
            return;
          }

          if (!isAboutShown && index === 0 && e.deltaY < 0) {
            const now = Date.now();
            if (now - lastUpScrollTime > 500) {
              lastUpScrollTime = now;
              switchToView("about", "scroll");
            } else {
              e.preventDefault();
            }
            return;
          }

          if (e.deltaY < 0) {
            lastUpScrollTime = Date.now();
          }

          e.preventDefault();
          index += e.deltaY > 0 ? 1 : -1;
          index = clamp(index, 0, total - 1);
          updateMargin();
        },
        { passive: false }
      );

      // generate block
      items
        .slice()
        .reverse()
        .forEach(({ image, link }, i, arr) => {
          const imgBlock = document.createElement("div");
          imgBlock.className = "block";
          if (i === index) imgBlock.classList.add("active");
          const resolvedImage = image || `https://image.thum.io/get/maxAge/12/width/700/${link}`;
          imgBlock.innerHTML = `<img src="${resolvedImage}" style="${image ? "" : "object-position: top;"}" />`;
          imgBlock.addEventListener("click", () => {
            index = i;
            updateMargin();
          });
          works.appendChild(imgBlock);

          const descBlock = document.createElement("div");
          descBlock.className = "block";
          descBlock.innerHTML = `<span class="title">Loading...</span>`;
          descriptions.appendChild(descBlock);

          const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(link);
          fetchWithRetry(proxyUrl)
            .then((html) => {
              if (!html) {
                console.warn(`❌ Failed to fetch metadata (final result is null): ${link}`);
                descBlock.innerHTML = `<span class="title">Failed to load metadata</span>`;
                return;
              }
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const title = doc.querySelector("title")?.textContent || "(no title)";
              const meta =
                doc.querySelector('meta[name="description"]')?.getAttribute("content") ||
                doc.querySelector('meta[property="og:description"]')?.getAttribute("content") ||
                doc.querySelector("p")?.textContent?.trim() ||
                "(no description)";
              descBlock.innerHTML = `<div class="title"><a href="${link}" target="_blank">${title}</a></div><div>${meta}</div>`;
            })
            .catch((err) => {
              console.error(`❌ Completely failed: ${link}`, err);
              descBlock.innerHTML = `<span class="title">Failed to load metadata</span>`;
            });
        });

      function fetchWithRetry(url, retries = 5, delay = 1000) {
        return fetch(url)
          .then((res) => {
            if (!res.ok) throw new Error(`Fetch failed with status ${res.status}`);
            return res.text();
          })
          .catch((err) => {
            if (retries <= 0) {
              console.warn("❌ All retries failed:", err.message);
              return null;
            }
            console.warn(`⚠️ Fetch failed: ${err.message}. Retrying... ${retries} retries left`);
            return new Promise((resolve) => setTimeout(() => resolve(fetchWithRetry(url, retries - 1, delay)), delay));
          });
      }

      worksOptionRight.textContent = ("00" + total).slice(-2);
      worksOptionLeft.textContent = ("00" + (index + 1)).slice(-2);

      function updateMargin() {
        const offset = `calc(-${index} * (100% + 1rem))`;
        works.querySelector(".block")?.style.setProperty("margin-left", offset);
        descriptions.querySelector(".block")?.style.setProperty("margin-left", offset);
        worksOptionLeft.textContent = ("00" + (index + 1)).slice(-2);
        works.querySelectorAll(".block").forEach((el, i) => {
          el.classList.toggle("active", i === index);
        });
      }

      function clamp(val, min, max) {
        return Math.max(min, Math.min(max, val));
      }

      function handleSwipe() {
        const dx = touchEndX - touchStartX;
        const threshold = 25; // minimum swipe distance

        if (Math.abs(dx) < threshold || isAboutShown) return;

        if (dx > 0) {
          index = clamp(index - 1, 0, total - 1);
        } else {
          index = clamp(index + 1, 0, total - 1);
        }
        updateMargin();
      }

      // update labelWrapper height on resize
      window.addEventListener("resize", function () {
        labelWrapper.style.height = mainMiddle.clientHeight + "px";
      });
      labelWrapper.style.height = mainMiddle.clientHeight + "px";
    </script>
  </body>
</html>
